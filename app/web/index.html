<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Klug Media</title>
    <link rel="stylesheet" href="/web/styles.css" />
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <h1>Klug Media</h1>
        <p class="muted">Session-based frontend smoke page</p>
        <div id="auth-status" class="muted">Checking session...</div>
        <div class="ops-strip">
          <span id="ops-health" class="muted">API Health: checking...</span>
          <span id="ops-auth-mode" class="muted">Auth Mode: unknown</span>
          <span id="ops-session" class="muted">Session: unknown</span>
          <span id="ops-last-refresh" class="muted">Last Refresh: not yet</span>
        </div>
      </div>

      <div id="login-card" class="card hidden">
        <h2>Login</h2>
        <form id="login-form">
          <input id="password" type="password" placeholder="Session password" required />
          <button type="submit">Login</button>
        </form>
        <p id="login-error" class="error"></p>
      </div>

      <div id="app-card" class="card hidden">
        <div class="row">
          <button id="refresh-data">Refresh Data</button>
          <button id="logout-btn" class="secondary">Logout</button>
        </div>

        <h2 style="margin-top: 18px">Import Watch History</h2>
        <form id="import-form">
          <input
            id="import-file"
            type="file"
            accept=".json,.csv,application/json,text/csv"
            required
          />
          <input id="import-user-id" type="text" placeholder="User UUID (required for legacy backup)" />
          <select id="import-mode">
            <option value="bootstrap">Bootstrap</option>
            <option value="incremental">Incremental</option>
          </select>
          <label class="checkbox">
            <input id="import-dry-run" type="checkbox" checked />
            Dry Run
          </label>
          <label class="checkbox">
            <input id="import-resume" type="checkbox" />
            Resume From Latest
          </label>
          <button id="import-use-latest-cursor" type="button" class="secondary">
            Use Latest Cursor
          </button>
          <button id="import-submit" type="submit">Run Import</button>
        </form>
        <p id="import-status" class="muted">No import started.</p>
        <p id="import-cursor-before" class="muted">Cursor before: none</p>
        <p id="import-cursor-after" class="muted">Cursor after: none</p>
        <p id="import-last-cursor" class="muted">Last successful local cursor: none</p>
        <pre id="import-summary" class="code-block"></pre>
        <p id="import-errors-status" class="muted"></p>
        <ul id="import-errors-list"></ul>

        <h2 style="margin-top: 18px">Import History</h2>
        <div class="row">
          <label for="import-history-status-filter">Status</label>
          <select id="import-history-status-filter">
            <option value="">All</option>
            <option value="running">running</option>
            <option value="completed">completed</option>
            <option value="completed_with_errors">completed_with_errors</option>
            <option value="failed">failed</option>
          </select>
          <button id="import-history-clear-filter" type="button" class="secondary">
            Clear Filter
          </button>
        </div>
        <p id="import-history-status" class="muted">Loading import history...</p>
        <table>
          <thead>
            <tr>
              <th>Started</th>
              <th>Status</th>
              <th>Source</th>
              <th>Inserted</th>
              <th>Errors</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="import-history-body"></tbody>
        </table>
        <p id="import-detail-status" class="muted">Select an import batch to view details.</p>
        <div class="row">
          <button id="import-download-errors" type="button" class="secondary" disabled>
            Download Errors JSON
          </button>
        </div>
        <pre id="import-detail" class="code-block"></pre>

        <h2>Shows</h2>
        <p id="shows-status" class="muted">Loading shows...</p>
        <ul id="show-list"></ul>
        <h2 style="margin-top: 18px">Progress</h2>
        <p id="progress-status" class="muted">Loading progress...</p>
        <table>
          <thead>
            <tr>
              <th>Show</th>
              <th>Watched</th>
              <th>Total</th>
              <th>Percent</th>
            </tr>
          </thead>
          <tbody id="progress-body"></tbody>
        </table>

        <h2 style="margin-top: 18px">Recent Watch History</h2>
        <div class="row">
          <label for="history-media-type">Media Type</label>
          <select id="history-media-type">
            <option value="">All</option>
            <option value="movie">Movie</option>
            <option value="show">Show</option>
            <option value="episode">Episode</option>
          </select>
          <label for="history-limit">Rows</label>
          <select id="history-limit">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
          <button id="history-apply" class="secondary">Apply</button>
        </div>
        <p id="history-status" class="muted">Loading history...</p>
        <table>
          <thead>
            <tr>
              <th>Watched At</th>
              <th>Title</th>
              <th>Type</th>
              <th>Source</th>
              <th>Completed</th>
              <th>Progress</th>
            </tr>
          </thead>
          <tbody id="history-body"></tbody>
        </table>
        <div class="row">
          <button id="history-prev" class="secondary">Previous</button>
          <button id="history-next" class="secondary">Next</button>
          <span id="history-page" class="muted">Page 1</span>
        </div>
      </div>

      <div id="detail-card" class="card hidden">
        <h2 id="detail-title">Show Detail</h2>
        <p id="detail-progress" class="muted"></p>
        <p id="detail-status" class="muted">Select a show to load details.</p>
        <ul id="episode-list"></ul>
      </div>
    </div>

    <script src="/web/app.js" defer></script>
  </body>
</html>
